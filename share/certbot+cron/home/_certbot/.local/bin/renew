#!/bin/sh
set -e

##
# variables
localbase=$(realpath "$(dirname "$0")"/..)
libexec="${localbase}"/libexec/certbot+cron
myhome="${HOME}"
etcdir="${LOCALBASE:-/usr/local}"/etc/letsencrypt

##
# functions
printok()
{
    printf "ok: %s\n" "${1}" > /dev/stdout
}

##
# main
set -x
certbot renew \
        --manual \
        --manual-auth-hook "${libexec}"/set-challenge \
        --preferred-challenges dns \
        --work-dir "${localbase}" \
        --logs-dir "${localbase}"/var/log \
        --config-dir "${etcdir}"
set +x
printok "done"
